function GetConfirmationText(e,t){return"Tree"==t?e.replace("{0}",treeSelectionTitle):e.replace("{0}",gridSelectionTitles)}function resolveUrl(e){return appPath+e}function itemThumbnail(e){return""==e||null==e?"":isNaN(e)?'<img src="'+thumbnailPath+e+'" alt="" class="thumbnail" />':'<img src="'+downloadUrl+"?PortalId="+portalId+"&EntryId="+e+'" alt="" class="thumbnail" />'}function attachThumbnailRollovers(){$(".thumbnail").parent().parent().hover(function(e){$(this).children().children(".thumbnail").css({left:e.pageX+10-$(window).scrollLeft(),top:e.pageY+10-$(window).scrollTop()}).fadeIn(300)},function(){$(this).children().children(".thumbnail").fadeOut(100)})}function Grid1_onSortChange(e,t){var l=t.get_descending(),d=t.get_column();Grid1.sortMulti([5,!l,d.ColumnNumber,l])}function resizeTree(e,t){updateSizeBox(),TreeviewRedraw()}function resizeGrid(e,t){updateSizeBox(),GridRedraw(isSplitterLoaded),isSplitterLoaded||(FixGridColumnWidths(),Grid1.Render())}function updateSizeBox(){var e,t=Splitter1.get_panes()[0];e=t.get_width()+"|",e=e+t.get_height()+"|",t=Splitter1.get_panes()[1],e=e+t.get_width()+"|",e=e+t.get_height()+"|",e=e+lastSelectedNode+"|",e=e+lastSelectedItems+"|",document.getElementById(hidStuff).value=e}function LoadTreeViewContextMenu(e,t){ContextMenuCallBack.Callback(t.get_node().get_id())}function LoadGridContextMenu(e,t){0==e.getSelectedItems().length?e.select(t.get_item(),!1):lastSelectedItems[0]!=t.get_item().getMember("EntryId").get_value()&&e.select(t.get_item(),!1);var l;l=TreeView1.get_selectedNode()?TreeView1.get_selectedNode().get_id():"ent0";var d=e.getSelectedItems(),n=new Array;for(i=0;i<d.length;i++)n[n.length]="ent"+d[i].getMember("EntryId").get_value();ContextMenuCallBack.Callback(l,n)}function OnCallBackError(e,t){}function tvCallbackComplete(e,t){repairTreeClasses()}function TreeViewNodeSelect(e,t){repairTreeClasses(),lastSelectedNode!=t.get_node().get_id()&&(lastSelectedItems=null),lastSelectedNode=t.get_node().get_id(),treeSelectionTitle=t.get_node().get_text(),MenuCallBack.Callback(t.get_node().get_id()),setTimeout("GridRedraw(true)",100),updateSizeBox()}function GridItemSelect(e,t){if(!autoSelect){var l;l=TreeView1.get_selectedNode()?TreeView1.get_selectedNode().get_id():"ent0";var d=new Array;for(d=e.getSelectedItems(),lastSelectedItems=new Array,i=0;i<d.length;i++)lastSelectedItems[lastSelectedItems.length]=d[i].getMember("EntryId").get_value();if(1==d.length)MenuCallBack.Callback(l,"ent"+d[0].getMember("EntryId").get_value()),gridSelectionTitles=d[0].getMember("Title").get_value(),selection=["ent"+d[0].getMember("EntryId").get_value()];else{var n=new Array;for(gridSelectionTitles="",i=0;i<d.length;i++)n[n.length]="ent"+d[i].getMember("EntryId").get_value(),gridSelectionTitles=gridSelectionTitles+", "+d[i].getMember("Title").get_value();gridSelectionTitles=gridSelectionTitles.substring(2),selectionChanged=!0,selection=n,MenuCallBack.Callback(l,n)}updateSizeBox()}}function MenuBeforeCallback(e,t){selectionChanged=!1}function MenuCallbackComplete(e,t){if(selectionChanged){var l;l=TreeView1.get_selectedNode()?TreeView1.get_selectedNode().get_id():"ent0",MenuCallBack.Callback(l,selection)}}function MenuExpand(e,t){}function GridItemDoubleClick(e,t){t.get_item().getMember("IsCollection").get_value()?"Bring2mind/DMX/Views/AjaxTwoPanel.ascx"==t.get_item().getMember("ControlToLoad").get_value()?(TreeView1.findNodeById("ent"+t.get_item().getMember("EntryId").get_value()).expand(),TreeView1.findNodeById("ent"+t.get_item().getMember("EntryId").get_value()).select(),Grid1&&Grid1.dispose(),GridCallBack.Callback("ent"+t.get_item().getMember("EntryId").get_value())):window.location=baseUrl+baseUrlSuffix+"EntryId="+t.get_item().getMember("EntryId").get_value():(t.get_item().getMember("EntryType").get_value().startsWith("Hyperlink")&&window.open(appPath+"DesktopModules/Bring2mind/DMX/API/Entries/Download?PortalId="+portalId+"&EntryId="+t.get_item().getMember("EntryId").get_value(),"",""),t.get_item().getMember("EntryType").get_value().startsWith("File")&&window.open(baseUrl+baseUrlSuffix+"Command=Core_Download&EntryId="+t.get_item().getMember("EntryId").get_value(),"","")),updateSizeBox()}function CommandCallBackComplete(e,t){if("true"==cbresult.result.isinerror)return $("#"+divFeedbackFormId).attr("class","NormalRed"),$("#"+divFeedbackFormId).html(cbresult.result.message),void dlgFeedback.Show();"true"==cbresult.result.showpopup&&($("#"+divFeedbackFormId).attr("class",""),$("#"+divFeedbackFormId).html(cbresult.result.message),dlgFeedback.Show());var l,d=cbresult.result.command,n=cbresult.result.argslist;switch(l=TreeView1.get_selectedNode()?TreeView1.get_selectedNode().get_id():"ent0",d){case"CopyToCB":case"CutToCB":case"RemoveFromCB":case"ClearCB":MenuCallBack.Callback(l,n);break;case"Delete":case"HardDelete":if(n==lastSelectedNode)window.location=baseUrl;else{var a=new Array;for(a=Grid1.getSelectedItems(),i=0;i<a.length;i++){var r="ent"+a[i].getMember("EntryId").get_value(),o=TreeView1.findNodeById(r);o&&o.remove()}repairTreeClasses(),MenuCallBack.Callback(l,n),Grid1.dispose(),GridCallBack.Callback(l)}break;case"Recover":"recyclebin"==lastSelectedNode?(MenuCallBack.Callback(l,""),Grid1.dispose(),GridCallBack.Callback(l),lastSelectedItems=""):window.location=baseUrl+baseUrlSuffix+"EntryId="+lastSelectedNode;break;case"Move":for(i=0;i<selection.length;i++)Grid1.deleteItem(Grid1.getItemFromKey(0,selection[i].substring(3)));if(selection=null,setTimeout("GridRedraw(false);",1e3),"undefined"!=typeof draggedItem&&"Collection"==draggedItem.getMember("EntryType").get_text()){var c=TreeView1.findNodeById(draggedItemId),s=TreeView1.findNodeById(targetItemId);c&&(c.remove(),s&&s.get_nodes().add(c))}break;default:MenuCallBack.Callback(l,n),Grid1.dispose(),GridCallBack.Callback(l)}}function GridItemsCommand(e,t){CommandCallBack.Callback(e,t)}function CallView(e){ViewCallBack.Callback($(window).width(),$(window).height(),e)}function ViewCallBackComplete(e,t){var l=document.getElementById("dlgView").style.height;l.indexOf("px")>-1&&(l=l.substring(0,l.indexOf("px")));var d=parseInt(l),i=d-42;dialogDiv=document.getElementById("dlgView_InnerSpan"),dialogDiv.style.height=i+"px",dlgView.Show()}function editEntry(e,t,l){"-1"==e?EditCallBack.Callback("-1",t):EditCallBack.Callback(e,l),editEntryId=e,editParentId=t,Dialog1.Show()}function closedialog(){Dialog1.close(),Grid1.dispose(),GridCallBack.Callback(editParentId),TreeviewCallBack.Callback(editParentId)}function formatFileSize(e){return e>Math.pow(1024,3)?parseInt(e/Math.pow(1024,3))+" GB":e>Math.pow(1024,2)?parseInt(e/Math.pow(1024,2))+" MB":e>1024?parseInt(e/1024)+" KB":0==e?"":e+" B"}function handleWheel(e,t){var l=e.PageSize,d=e.RecordOffset,i=e.RecordCount;if(i>l){var n=parseInt(-1*t*l/2);n+d>i?e.ScrollTo(i-l):n+d<0?e.ScrollTo(0):e.ScrollBy(n)}}function wheel(e){e||(e=window.event);var t=e.target||e.srcElement;t=Grid1;var l=0;e.wheelDelta?(l=e.wheelDelta/120,window.opera&&(l=-l)):e.detail&&(l=-e.detail/3),l&&handleWheel(t,l),e.preventDefault&&e.preventDefault(),e.returnValue=!1}function enableMouseWheel(e){var t=document.getElementById(e+"_dom");t&&(t.addEventListener?(t.removeEventListener("DOMMouseScroll",wheel,!1),t.addEventListener("DOMMouseScroll",wheel,!1)):t.onmousewheel=wheel)}function enableSelectAll(e){var t=document.getElementById(e+"_dom");t&&(t.addEventListener?(t.removeEventListener("onkeydown",selectAll,!1),t.addEventListener("onkeydown",selectAll,!1)):t.attachEvent?(t.detachEvent("onkeydown",selectAll),t.attachEvent("onkeydown",selectAll)):dome.onkeydown=selectAll)}function selectAll(e){e||(e=window.event);var t=e.target||e.srcElement;if(e.ctrlKey&&isKeyA(e.keyCode)){if(t=Grid1,t.RecordCount>1e3)return!1;for(var l=0;l<t.RecordCount;l++){var d=t.Table.GetRow(l);d.Selected||t.Select(d,!0)}return!1}return!0}function isKeyA(e){return 97==e||65==e}function TreeviewCallBackComplete(e,t){TreeviewRedraw(!1)}function TreeviewRedraw(e){var t=document.getElementById(hidStuff).value.split("|");if(document.getElementById("TreeContainer").style.width=t[0]+"px",document.getElementById("TreeContainer").style.height=t[1]+"px",TreeView1&&(TreeView1.render(),e&&lastSelectedNode)){var l=TreeView1.findNodeById(lastSelectedNode);l&&(l.expand(),l.select())}repairTreeClasses()}function repairTreeClasses(){$("table.TreeNode tbody tr td[vAlign=middle]:not([class])").attr("class",function(){return jQuery(this).parent().parent().parent().attr("class")}),$("table.TreeNode tbody tr td[vAlign=middle]").removeClass("TreeNode"),$("table.TreeNode").attr("class","TreeNode")}function GridCallBackComplete(e,t){if(GridRedraw(!1),FixGridColumnWidths(),Grid1.render(),lastSelectedItems){for(autoSelect=!0,i=0;i<lastSelectedItems.length;i++)selectGridRow(lastSelectedItems[i]);autoSelect=!1}attachThumbnailRollovers()}function selectGridRow(e){for(j=0;j<Grid1.get_table().getRowCount();j++)Grid1.get_table().getRow(j).getMember("EntryId").get_value()==e&&Grid1.select(Grid1.get_table().getRow(j),!0)}function gridRenderComplete(e,t){var l=document.getElementById(hidStuff).value.split("|");if(document.getElementById(Grid1.get_id()+"_dom").style.height=l[3]-29+"px",document.getElementById(Grid1.get_id()+"_VerticalScrollDiv").style.height=l[3]-57+"px",void 0!=DMX&&void 0!=DMX.hookDragAndDrop){var d=void 0==lastSelectedNode?-1:lastSelectedNode.substring(3);DMX.hookDragAndDrop(d)}}function GridRedraw(e){var t=document.getElementById(hidStuff).value.split("|");GridCallBack.element.style.width=t[2]-2+"px",Grid1.element.style.width=t[2]-2+"px",GridCallBack.element.style.height=t[3]+"px",document.getElementById(Grid1.get_id()+"_dom").style.height=t[3]-52+"px",e&&(lastSelectedNode?Grid1&&(Grid1.dispose(),GridCallBack.Callback(lastSelectedNode)):(FixGridColumnWidths(),Grid1.render())),attachThumbnailRollovers()}function FixGridColumnWidths(){var e,t,l=Grid1.get_table().get_columns();for(e=0;e<l.length;e++)t=l[e],t.get_fixedWidth()||t.set_width(0)}function loadEvent(){var e=document.getElementById(hidStuff).value.split("|");e[4].length>0&&-1==e[4].indexOf("undefined")&&(lastSelectedNode=e[4]),e[5].length>0&&-1==e[5].indexOf("undefined")&&(lastSelectedItems=e[5].split(","))}function clearSearch(){txt1Search.value="",txt2Search.value="",txt3Search.value="",txt4Search.value="",txtQuickSearch.value="",TabStrip2.selectTabById("tabQuickSearch")}function showSearch(){switch("searchresults"!=lastSelectedNode&&(lastSearchedNode=lastSelectedNode||-2),TabStrip2.getSelectedTab().get_value()){case"regularsearch":var e="";for(i=0;i<rblScope.length;i++){var t=rblScope[i];if("radio"==t.type&&t.checked){e=t.value;break}}CommandCallBack.Callback("RegularSearch",dd1Field.options[dd1Field.selectedIndex].value,dd1Selection.options[dd1Selection.selectedIndex].value,txt1Search.value,chk1Exact.checked,dd2Field.options[dd2Field.selectedIndex].value,dd2Selection.options[dd2Selection.selectedIndex].value,txt2Search.value,chk2Exact.checked,dd3Field.options[dd3Field.selectedIndex].value,dd3Selection.options[dd3Selection.selectedIndex].value,txt3Search.value,chk3Exact.checked,dd4Field.options[dd4Field.selectedIndex].value,dd4Selection.options[dd4Selection.selectedIndex].value,txt4Search.value,chk4Exact.checked,ddCombination.options[ddCombination.selectedIndex].value,chkAllVersions.checked,e,lastSearchedNode);break;default:var l="";for(i=0;i<rblFields.length;i++){var t=rblFields[i];if("radio"==t.type&&t.checked){l=t.value;break}}var e="";for(i=0;i<rblScopeQ.length;i++){var t=rblScopeQ[i];if("radio"==t.type&&t.checked){e=t.value;break}}CommandCallBack.Callback("QuickSearch",txtQuickSearch.value,l,e,lastSearchedNode)}Grid1.dispose(),setTimeout("GridCallBack.Callback('searchresults');",1500),setTimeout("TreeView1.selectNodeById('searchresults');",1e3),Dialog2.Close()}function checkvalue(){alert(rblScope.length)}function GridLoad(e,t){enableMouseWheel(grid1clientId),enableSelectAll(grid1clientId),isGridLoaded=!0}function SplitterLoad(e,t){setTimeout("AfterSplitterLoad();",1500)}function AfterSplitterLoad(){TreeviewRedraw(isPostBack),GridRedraw(isPostBack),isSplitterLoaded=!0}function Dialog2_onShow(){setTimeout("txtQuickSearch.focus();",500)}function captureKeys(e){void 0!=(e=e||window.event)&&(kCode=e.keyCode||e.which,(e.ctrlKey&&70==kCode||e.ctrlKey&&e.shiftKey&&70==kCode)&&(Dialog2.Show(),e.cancelBubble=!0,e.returnValue=!1))}function dragDropNode(e,t){draggedItemId=t.get_node().get_id(),targetItemId=t.get_newParentNode().get_id(),GridItemsCommand("Move",draggedItemId+","+targetItemId),setTimeout("GridRedraw(false);",1e3)}function dragDropGridItem(e,t){var l=t.get_targetControl().get_id(),d=t.get_target();null==selection&&(selection=["ent"+t.get_item().getMember("EntryId").get_value()]),targetItemId=endsWith(l,"Grid1")?"ent"+d.getMember("EntryId").get_text():d.get_id(),"ent"==targetItemId.substr(0,3)?GridItemsCommand("Move",selection+","+targetItemId):"cat"==targetItemId.substr(0,3)?(GridItemsCommand("Move",selection+","+targetItemId),selection=null):alert(noPermission)}function dglViewResize(e,t){$("#dlgViewContent").width($("#dlgView_InnerSpan").width()-10),$("#dlgViewContent").height($("#dlgView_InnerSpan").height())}function DialogMaximize(e){$("#"+e).width($(window).width()).height($(window).height()).offset({left:0,top:0}),$("#dlgView_InnerSpan").height($(window).height()-$("#dlgView_HeaderSpan").height()-$("#dlgView_FooterSpan").height()),$("#dlgViewContent").width($("#dlgView_InnerSpan").width()-10),$("#dlgViewContent").height($("#dlgView_InnerSpan").height())}function showLink(e){if("function"==typeof $().modal)return $("#dmxShowLinkText").val(e),$("#dmxShowLink").modal("show"),$("#dmxShowLinkLink").text(e).attr("href",e),$("#dmxShowLinkText").on("click",function(){$(this).select()}),!1;var t=window.open("","newwin","resizable=no,width=800,height=100");t.document.open(),t.document.write(""),t.document.write("<table width=90% align=center><tr><td>"),t.document.write(urlLink),t.document.write("<br><br><a href=# onClick=window.close();><b>Close</b></a>"),t.document.write("</td></tr></table>"),t.document.close(),t.focus()}var _MouseX=0,_MouseY=0,CA_IE=!!document.all,b_mode="CSS1Compat"==document.compatMode?"S":"Q",editEntryId,editParentId,lastSelectedNode,lastSearchedNode,lastSelectedItems,selectionChanged,selection,cbresult,gridSelectionTitles,treeSelectionTitle,autoSelect=!1,draggedItemId,targetItemId;$(document).ready(function(){$("div.VCBox").bind("contextmenu",function(e){return!1}),$(document).mousemove(function(e){_MouseX=e.pageX,_MouseY=e.pageY})}),String.prototype.startsWith=function(e){return 0==this.indexOf(e)};